generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String        @id
  name         String?
  email        String?       @unique
  createdAt    DateTime      @default(now()) @map("created_at")

  bills        Bill[]        @relation("UserBills")

  @@map("users")
}

model Bill {
  id           String        @id @default(uuid()) @map("id")
  title        String        @map("title")
  merchantName String?       @map("merchant_name")

  subtotal      Decimal?      @default(0)
  tax           Decimal?      @default(0)
  totalDiscount Decimal?      @default(0) @map("totla_discount")
  rounding      Decimal?      @default(0)
  totalAmount   Decimal?      @default(0) @map("total_amount")

  createdById   String        @map("created_by")
  createdAt     DateTime      @default(now()) @map("created_at")

  createdBy     User          @relation("UserBills", fields: [createdById], references: [id])
  items         BillItem[]
  participants  Participant[]
  receipt       Receipt?
  splits        BillSplit[]

  @@map("bills")
}

model BillItem {
  id          String      @id @default(uuid()) @map("id")
  billId      String      @map("bill_id")
  name        String      @map("name")
  quantity    Decimal     @map("quantity")
  unitPrice   Decimal     @map("unit_price")
  discount    Decimal     @map("discount")
  totalPrice  Decimal     @map("total_price")
  description String?     @map("description")

  bill        Bill        @relation(fields: [billId], references: [id])
  splits      BillSplit[]

  @@map("bill_items")
}

model Participant {
  id           String   @id
  billId       String
  userId       String?
  displayName  String

  bill         Bill     @relation(fields: [billId], references: [id])
  splits       BillSplit[]

  @@map("participants")
}

model BillSplit {
  id            String   @id @default(uuid())
  billId        String
  billItemId    String
  participantId String
  amount        Decimal

  bill          Bill        @relation(fields: [billId], references: [id])
  item          BillItem    @relation(fields: [billItemId], references: [id])
  participant   Participant @relation(fields: [participantId], references: [id])

  @@unique([billItemId, participantId])
  @@map("bill_splits")
}

model Receipt {
  id           String   @id @default(uuid()) @map("id")
  billId       String   @unique @map("bill_id")
  imageUrl     String?  @map("image_url")
  rawOcrText   String?  @map("raw_ocr_text")
  aiParsedJson Json?    @map("ai_parsed_json")
  createdAt    DateTime @default(now()) @map("created_at")

  bill         Bill     @relation(fields: [billId], references: [id])

  @@map("receipts")
}
